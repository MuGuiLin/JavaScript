<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>使用Blob加载workerJs文件</title>
</head>

<body>
    <h1>使用Blob加载workerJs文件</h1>
    <hr />
    <h3>
        注意：由于Content Security Policy
        (CSP)限制导致的。现代浏览器出于安全考虑，可能会阻止通过Blob URL创建Web
        Worker。
    </h3>
    <script>
        const simpleWorker = `
            self.onmessage = function(e) {
                console.log("Worker内部：收到消息", e.data, self);
                self.postMessage("Worker内部：已发送消息（Hello from worker!）");
            };
        `;
        console.log("workerJs字符串代码：", simpleWorker);
        
        try {
            // 开始创建Worker
            const blob = new Blob([simpleWorker], {
                type: "application/javascript",
            });
            const workerUrl = URL.createObjectURL(blob);
            const worker = new Worker(workerUrl);
            
            // Worker创建成功，监听Worker返回消息
            worker.onmessage = function (e) {
                console.log("收到线程simpleWorker返回的信息：", e.data);
                worker.terminate();
                URL.revokeObjectURL(workerUrl);
            };

            worker.onerror = function (e) {
                console.error("Worker发生错误：", e);
                console.error("错误信息：", e.message);
                console.error("错误文件：", e.filename);
                console.error("错误行号：", e.lineno);
                URL.revokeObjectURL(workerUrl);
            };

            //发送消息给Worker
            worker.postMessage("");

        } catch (e) {
            console.error("Worker报错：", e);
        }
    </script>
</body>

</html>